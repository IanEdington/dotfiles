#!/usr/bin/env bash
# Bash Strict Mode: http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail
IFS=$'\n\t'
# Bash Strict Mode

source bash_utils.sh

# Starting the fun stuff
# ----------------------

# Ask for the administrator password upfront
if command_exists sudo; then
    sudo -v
    # Keep-alive: update existing `sudo` time stamp until `.macos` has finished
    while true; do
        sudo -n true;
        sleep 60;
        kill -0 "$$" || exit;
    done 2>/dev/null &
fi

# Symlink the current folder to .dotfiles
# ref: http://stackoverflow.com/a/246128/4301584
DOTFILES_ROOT="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd -P )"
dotfiles::symlink_files $DOTFILES_ROOT $HOME/.dotfiles;
cd $HOME/.dotfiles
log "dotfiles root $DOTFILES_ROOT"

# Make sure expected folders exist
mkdir $HOME/.local &> /dev/null || true

# Add paths to this shell
source $HOME/.dotfiles/path.sh

# SymLink Other base configs
dotfiles::symlink_files ~/.dotfiles/config ~/.config
dotfiles::symlink_files ~/.dotfiles/inputrc ~/.inputrc
dotfiles::symlink_files ~/.dotfiles/profile ~/.profile

# Install Scripts
# Run install scripts for each folder in dotfiles/
for dir in */ ; do
    log Installing the $dir directory:
    cd $dir;

    if [ -f install ]; then
        source ./install
    fi

    cd $HOME/.dotfiles
done

