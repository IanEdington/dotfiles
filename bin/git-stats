#!/bin/bash
# Tiny script to generate git statistics
# Author: https://github.com/esc
# From https://github.com/Naereen/git-stats/blob/master/git-stats.sh

echo -e "$(basename $0): do statistics on this git repository."
echo -e "  From https://github.com/esc/git-stats/"
echo -e "\nNumber of commits per author:"

git --no-pager shortlog -sn --all -- email-templates
AUTHORS="$(git shortlog "${END_AND_BEGIN[@]}" -sn --all -- email-templates | cut -f2 | cut -f1 -d' ')"

longtiret='----------------------------------------------------------------------------------------------------------'

for a in $AUTHORS
do
    echo -e "\n----------------${longtiret:0:${#a}}"
    echo -e "Statistics for: $a"
    echo -n "  - Number of files changed: "
    git log "${LOGOPTS[@]}" "${END_AND_BEGIN[@]}" --all --numstat --format="%n" --author="$a" | grep -v -e "^$" | cut -f3 | sort -iu | wc -l
    echo -n "  - Number of lines added: "
    git log "${LOGOPTS[@]}" "${END_AND_BEGIN[@]}" --all --numstat --format="%n" --author="$a" | cut -f1 | awk '{s+=$1} END {print s}'
    echo -n "  - Number of lines deleted: "
    git log "${LOGOPTS[@]}" "${END_AND_BEGIN[@]}" --all --numstat --format="%n" --author="$a" | cut -f2 | awk '{s+=$1} END {print s}'
    echo -n "  - Number of merges: "
    git log "${LOGOPTS[@]}" "${END_AND_BEGIN[@]}" --all --merges --author="$a" | grep -c '^commit'
done
